define("util",[],function(){var e=function(e){function t(){}function n(e,n){n=n||{id:t,className:t,tag:t,attribute:t};var a,r=[].slice.call(arguments,2);if(d=e.match(o))a="id",r.push(d[1]);else if(d=e.match(i))a="className",r.push(d[1]);else if(d=e.match(l))a="tag",r.push(d[0]);else if(d=e.match(s)){a="attribute";var c=d[1],u=d[2],f=d[4];r.push(c,u,f)}return n[a].apply(null,r)}function a(e,t){for(var o=e.pop(),i=[],l=0,s=t.length;l<s;l++){for(var c=t[l],d=c;d=d.parentNode;){var u={id:function(e,t){return e.id===t},className:function(e,t){return r(e,t)},tag:function(e,t){return e.tagName.toLowerCase()===t},attribute:function(e,t,n,a){var o=!0;return t&&(o=u.tag(e,t)),o=o&&e.hasAttribute(n),a&&(o=o&&a===e.getAttribute(n)),o}},f=n(o,u,d);if(f)break}f&&i.push(c)}return e[0]&&i[0]?a(e,i):i[0]}var o=/^#([\w_\-]+)/,i=/^\.([\w_\-]+)/,l=/^\w+$/i,s=/(\w+)?\[([^=\]]+)(?:=(["'])?([^\]"']+)\3?)?\]/,c=document,d=function(e,t){var o=n(e.pop(),{id:function(e){return[document.getElementById(e)]},className:function(e){var n=[];if(t.getElementsByClassName)n=t.getElementsByClassName(e);else for(var a=t.getElementsByTagName("*"),o=0,i=a.length;o<i;o++){var l=a[o];r(l,e)&&n.push(l)}return n},tag:function(e){return t.getElementsByTagName(e)},attribute:function(e,n,a){for(var o=[],i=t.getElementsByTagName(e||"*"),r=0,l=i.length;r<l;r++){var s=i[r];a?s.getAttribute(n)===a&&o.push(s):s.hasAttribute(n)&&o.push(s)}return o}});return o=[].slice.call(o),e[0]&&o[0]?a(e,o):o[0]}(e.split(/\s+/),c);return d},t=function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=function(e){return"[object Function]"===Object.prototype.toString.call(e)},a=function(e){var t,n=Object.prototype.hasOwnProperty;if(!(e&&"[object Object]"===Object.prototype.toString.call(e)&&"isPrototypeOf"in e))return!1;if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1;for(t in e);return void 0===t||n.call(e,t)},o=function(e){var n,i,r=e;if(!e||e instanceof Number||e instanceof String||e instanceof Boolean)return r;if(t(e)){r=[];var l=0;for(n=0,i=e.length;n<i;n++)r[l++]=o(e[n])}else if(a(e)){r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=o(e[n]))}return r},i=function(e){return e.match(/\S+.+\S/)},r=function(e,t){var n=e.className;if(!n)return!1;for(var a=0,o=(n=n.split(/\s+/)).length;a<o;a++)if(n[a]===t)return!0;return!1},l=function(e,t,n){t=t.replace(/^on/i,"").toLowerCase(),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},s=function(e,t){l(e,"click",t)},c=function(e,t,n,a){console.log("in delegateEvent"),l(e,n,function(e){var n=e||window.event,o=e.target||e.srcElement;o&&o.tagName===t.toUpperCase()&&(console.log("if matched"),a.call(o,n))})},d=function(e,t,n,a){l(e,n,function(e){var n=e||window.event,o=e.target||e.srcElement;o&&-1!==o.className.indexOf(t)&&a.call(o,n)})};console.log(typeof d),e.on=function(t,n,a){l(e(t),n,a)},e.click=function(t,n){s(e(t),n)},e.un=function(t,n,a){removeEventListener(e(t),n,a)},e.delegate=function(t,n,a,o){c(e(t),n,a,o)};return{$:e,isArray:t,isFunction:n,cloneObject:o,uniqArray:function(e){e.sort(function(e,t){return e===t?0:typeof e==typeof t?e<t?-1:1:typeof e<typeof t?-1:1});for(var t=0;t<e.length;t++)for(;e[t]===e[t+1];)e.splice(t+1,1);return e},trim:i,each:function(e,t){for(var n=0,a=e.length;n<a;n++)t(e[n],n)},getObjectLength:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},isEmail:function(e){return/^([\w\.\-\+])+\@([\w\-]+\.)+([\w]{2,10})+$/.test(e)},isMobilePhone:function(e){return/^1[3|5|8]\d{10}$/.test(e)},hasClass:r,addClass:function(e,t){r(e,t)||(e.className=i(e.className+" "+t))},removeClass:function(e,t){r(e,t)&&(e.className=i(e.className.replace(t," ")))},isSiblingNode:function(e,t){return e.parentNode===t.parentNode},getPosition:function(e){for(var t=0,n=0,a=e;null!==a;)t+=a.offsetLeft,n+=a.offsetTop,a=a.offsetParent;return{x:t,y:n}},addEvent:l,removeEvent:function(e,t,n){t=t.replace(/^on/i,"").toLowerCase(),e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+type]=null},addClickEvent:s,addEnterEvent:function(e,t){l(e,"keydown",function(n){13===n.keyCode&&t.call(e,event)})},delegateEvent:c,delegateDelEvent:d,isIE:function(){return/MSIE ([^;]+)/.test(navigator.userAgent)?parseFloat(RegExp.$1)||document.documentMode:-1},setCookie:function(e,t,n){var a=new Date;"number"==typeof n&&(a.setTime(a.getTime()+24*n*60*60*1e3),a=a.toGMTString()),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; expires="+a+"; path=/"},getCookie:function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),a=0,o=n.length;a<o;a++){var r=i(n[a]);if(0===r.indexOf(t))return r.slice(t.length,r.length)}return""},ajax:function(e,t){function a(e){var a=t[e="on"+e];if(n(a))if("onfail"===e)a(o);else{try{o.responseText}catch(e){return a(o)}a(o,o.responseText)}}var o,i=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}((t=t||{}).data||{}),r=(t.type||"GET").toUpperCase();try{"GET"===r&&i&&(e+=(-1===e.indexof("?")?"?":"&")+i,i=null),(o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open(r,e,!0),o.onreadystatechange=function(){var e;if(4===o.readyState){try{e=o.status}catch(e){return void a("fail")}a(e),a(e>=200&&e<300||304===e||1223===e?"success":"fail"),window.setTimeOut(function(){o.onreadystatechange=new Function,o=null},0)}},"POST"===r&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.setRequestHeader("X-Request-With","XMLHttpRequest"),o.send(i)}catch(e){a("fail")}return o},escape:function(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/`/g,"&#x60;").replace(/\//g,"&#x2f;")}}}),define("data",["util"],function(e){console.log(localStorage.cate);var t=function(){return JSON.parse(localStorage.cate)},n=function(e){for(var t=JSON.parse(localStorage.cate),n=t.length,a=0;a<n;a++)if(t[a].id==e)return t[a]},a=function(){return JSON.parse(localStorage.childCate)},o=function(e){for(var t=JSON.parse(localStorage.childCate),n=t.length,a=0;a<n;a++)if(t[a].id==e)return t[a]},i=function(e){var t=JSON.parse(localStorage.task),n=[],a=t.length;if("boolean"!=typeof e)return t;for(var o=0;o<a;o++)e&&t[o].done?n.push(t[o]):e||t[o].done||n.push(t[o]);return n},r=function(e){for(var t=i(),n=t.length,a=0;a<n;a++)if(t[a].id==e)return t[a]},l=function(e,t){var n=[],a=o(e).child,i=a.length;console.log(JSON.stringify(o(e))),console.log("arr: "+a);for(var l=0;l<i;l++){var s=r(a[l]);"boolean"!=typeof t?n.push(s):t&&s.done?n.push(s):t||s.done||n.push(s)}return n},s=function(e,t){console.log("in updateCateChildByAdd"),console.log(localStorage.cate);for(var n=JSON.parse(localStorage.cate),a=n.length,o=0;o<a;o++)if(n[o].id==e){n[o].child.push(t);break}localStorage.cate=JSON.stringify(n)},c=function(e,t){for(var n=JSON.parse(localStorage.cate),a=n.length,o=0;o<a;o++){var i=n[o];if(i.id==e)for(var r=0;r<i.child.length;r++)if(i.child[r]===t){i.child.splice(r,1);break}}localStorage.cate=JSON.stringify(n)},d=function(e,t){for(var n=a(),o=n.length,i=0;i<o;i++)if(n[i].id==e){n[i].child.push(t);break}localStorage.childCate=JSON.stringify(n)},u=function(e,t){console.log("in updateChildCateChildByDel");for(var n=a(),o=n.length,i=0;i<o;i++){var r=n[i];if(r.id==e){console.log(JSON.stringify(r.child));for(var l=0;l<r.child.length;l++)if(r.child[l]==t){r.child.splice(l,1);break}console.log(JSON.stringify(r.child))}}localStorage.childCate=JSON.stringify(n)},f=function(e){console.log("in deleteChildCate");for(var t=a(),n=0;n<t.length;n++){var o=t[n];if(o.id==e){t.splice(n,1),console.log(o.child);for(var i=0,r=o.child.length;i<r;i++)console.log(r),h(o.child[i]);c(o.parent,o.id)}}localStorage.childCate=JSON.stringify(t)},h=function(e){console.log("in deleteTaskById");for(var t=i(),n=0;n<t.length;n++){var a=t[n];if(a.id==e){t.splice(n,1),u(a.parent,a.id);break}}localStorage.task=JSON.stringify(t)};return{initDataBase:function(){if(!localStorage.cate||!localStorage.childCate||!localStorage.task){var e=[{id:0,name:"默认分类",child:[0]}],t=[{id:0,parent:0,name:"默认子分类",child:[-1]}],n=[{id:-1,parent:0,done:!0,name:"介绍",date:"2017-7-30",content:"这是一个个人任务管理系统，为离线应用，数据保存在本地硬盘。<br>"}];localStorage.cate=JSON.stringify(e),localStorage.childCate=JSON.stringify(t),localStorage.task=JSON.stringify(n)}},queryCates:t,queryCateById:n,queryTasksNumByCateId:function(e){for(var t=n(e),a=0,i=t.child.length,r=0;r<i;r++)a+=o(t.chlid[r]).child.length;return a},queryTasksNumByCate:function(e){for(var t=0,n=e.child.length,a=0;a<n;a++)t+=o(e.child[a]).child.length;return t},queryAllChildCates:a,queryChildCateById:o,queryChildCateByIdArr:function(t){if(console.log("in queryChildCateByIdArr"),e.isArray(t)){for(var n=[],a=t.length,i=0;i<a;i++)n.push(o(t[i]));return console.log(n),n}},queryAllTasks:i,queryTasksByDateInTaskArr:function(e,t){for(var n=[],a=t.length,o=0;o<a;o++)t[o].date===e&&n.push(t[o]);return n},queryTaskById:r,queryTasksByChildCateId:l,queryTasksByCateId:function(e,t){console.log("in queryTasksByCateId");for(var a=[],o=n(e).child,i=o.length,r=0;r<i;r++)a="boolean"!=typeof t?a.concat(l(o[r])):a.concat(l(o[r],t));return a},addCate:function(e){var t=JSON.parse(localStorage.cate),n={};n.id=t[t.length-1].id+1,n.name=e,n.child=[],t.push(n),localStorage.cate=JSON.stringify(t)},addChildCate:function(e,t){var n=JSON.parse(localStorage.childCate),a={};a.id=n[n.length-1].id+1,a.parent=e,a.name=t,a.child=[],console.log(a),n.push(a),console.log(n),localStorage.childCate=JSON.stringify(n),s(e,a.id),console.log("after updateCateChildByAdd: "+localStorage.cate)},addTask:function(e){var t=i();return e.id=t[t.length-1].id+1,t.push(e),d(e.parent,e.id),localStorage.task=JSON.stringify(t),console.log("in addTask, allTasks: "+localStorage.task),e.id},updateCateChildByAdd:s,updateCateChildByDel:c,updateChildCateChildByAdd:d,updateChildCateChildByDel:u,updateTaskStatusById:function(e){for(var t=i(),n=t.length,a=0;a<n;a++)if(t[a].id==e){t[a].done=!0;break}localStorage.task=JSON.stringify(t),console.log("after updateTaskStatusById, task: "+localStorage.task)},updateTaskById:function(e,t,n,a){for(var o=i(),r=o.length,l=0;l<r;l++){var s=o[l];if(s.id==e){s.name=t,s.date=n,s.content=a;break}}localStorage.task=JSON.stringify(o)},deleteCate:function(e){var n=t();console.log("id: "+e);for(var a=0;a<n.length;a++){var o=n[a];if(console.log("in for"),o.id==e){n.splice(a,1),console.log("cate spliced: "+n);for(var i=0,r=o.child.length;i<r;i++)f(o.child[i])}}localStorage.cate=JSON.stringify(n)},deleteChildCate:f,deleteTaskById:h}}),define("control",["util","data"],function(e,t){var n=-1,a="allCate",o=-1,i=1,r=!1,l=function(){console.log("in initCates");for(var n=t.queryCates(),a=t.queryChildCateById(0),o='<ul class="folder-wrap">',i=0;i<n.length;i++){var r="";if(0===n[i].child.length)r='<li><p class="folder no-default" cateid='+n[i].id+'><i class="fa fa-folder-open folder-icon" style="padding-right: 5px;" aria-hidden="true"></i>'+n[i].name+"("+t.queryTasksNumByCate(n[i])+')<i class="fa fa-trash-o del" style="color: #b00d07;"></i></p></li>';else{if(0===n[i].id)r='<li><p class="folder" cateid='+n[i].id+'><i class="fa fa-folder-open folder-icon" style="padding-right: 5px;" aria-hidden="true"></i>'+n[i].name+'(1)</p><ul class="file-wrap">',r+='<li><p class="file" cateid='+a.id+'><i class="fa fa-file-o file-icon" style="padding-right: 5px;" aria-hidden="true"></i>'+a.name+"(1)</li>";else{r='<li><p class="folder no-default" cateid='+n[i].id+'><i class="fa fa-folder-open folder-icon" style="padding-right: 5px;" aria-hidden="true"></i>'+n[i].name+"("+t.queryTasksNumByCate(n[i])+')<i class="fa fa-trash-o del" style="color: #b00d07;"></i></p><ul class="file-wrap">',console.log(n[i].child);for(var l=t.queryChildCateByIdArr(n[i].child),s=0;s<l.length;s++){r+='<li><p class="file no-default" cateid='+l[s].id+'><i class="fa fa-file-o file-icon" style="padding-right: 5px;" aria-hidden="true"></i>'+l[s].name+"("+l[s].child.length+')<i class="fa fa-trash-o del" style="color: #b00d07;"></i></p><li>'}}r+="</ul></li>"}o+=r}o+="</ul>",e.$("#list-content").innerHTML=o,e.$("#all-tasks span").innerHTML=t.queryAllTasks().length},s=function(){for(var n=t.queryCates(),a='<option value="-1">新增主分类</option>',o=0;o<n.length;o++)0!==n[o].id&&(a+='<option value="'+n[o].id+'">'+n[o].name+"</option>");e.$("#select-cate").innerHTML=a,e.$("#input-cate").innerHTML=""},c=function(){e.$(".cover").style.display="block"},d=function(n,a){console.log(a);var o=a.parentNode;console.log(o),/folder/.test(o.className)?confirm("是否确定删除分类？")&&t.deleteCate(o.getAttribute("cateid")):/file/.test(o.className)?confirm("是否确定删除子分类？")&&t.deleteChildCate(o.getAttribute("cateid")):/task-self/.test(o.className)&&confirm("是否确定删除此任务")&&t.deleteTaskById(o.getAttribute("taskid")),l(),e.$("#task-list").innerHTML=v(t.queryAllTasks()),h(e.$("#all-tasks"))},u=function(){var n=e.$("#select-cate").value,a=e.$("#input-cate").value;""!==a?(console.log(typeof n),console.log(a),-1==n?(console.log("about going in addCate"),t.addCate(a)):(console.log("about going in addChildCate"),t.addChildCate(n,a)),console.log(localStorage.cate),l(),e.$(".cover").style.display="none",s()):alert("请输入新分类名称")},f=function(){e.$(".cover").style.display="none"},h=function(i){console.log("in clickOnCate"),g(),e.addClass(i,"selected");var r=e.$("#task-list"),l=i.getAttribute("cateid");console.log("cateid:"+l),"all-tasks"===i.getAttribute("id")?(r.innerHTML=v(t.queryAllTasks()),n=-1,a="allCate"):/folder/.test(i.className)?(r.innerHTML=v(t.queryTasksByCateId(l)),n=l,a="cate"):/file/.test(i.className)&&(r.innerHTML=v(t.queryTasksByChildCateId(l)),n=l,a="childCate"),y(),e.addClass(e.$("#all"),"selected"),e.$("[taskid]")&&e.addClass(e.$("[taskid]"),"selected"),T(o),A()},g=function(){for(var t=document.getElementsByClassName("folder"),n=document.getElementsByClassName("file"),a=0,o=t.length;a<o;a++)e.removeClass(t[a],"selected");for(var i=0,r=n.length;i<r;i++)e.removeClass(n[i],"selected");e.removeClass(e.$("#all-tasks"),"selected")},p=function(e){for(var n=[],a=[],i=0;i<e.length;i++)-1===n.indexOf(e[i].date)&&n.push(e[i].date);console.log("dateArr:    "+n),n=n.sort(),console.log("dateArr:    "+n);for(var r=0;r<n.length;r++){var l={};l.date=n[r],l.task=t.queryTasksByDateInTaskArr(n[r],e),a.push(l)}return console.log("sortedTask: "+JSON.stringify(a)),o=a[0].task[0].id,a},v=function(e){console.log("in createTaskList, task: "+JSON.stringify(e));var t="";if(!e.length)return t;var n=p(e);console.log("sortedTask: "+JSON.stringify(n));for(var a=0,o=n.length;a<o;a++){console.log("l:"+o);var i=n[a];t+='<div class="time">'+i.date+"</div><ul>";for(var r=0,l=i.task.length;r<l;r++){t+=i.task[r].done?-1==i.task[r].id?'<li class="task-done task-self" taskid="'+i.task[r].id+'"><i class="fa fa-check" style="color: #23b812; padding-right: 5px;" aria-hidden="true"></i>'+i.task[r].name+"</li>":'<li class="task-done task-self" taskid="'+i.task[r].id+'"><i class="fa fa-check" style="color: #23b812; padding-right: 5px;" aria-hidden="true"></i>'+i.task[r].name+'<i class="fa fa-trash-o del" style="color: #b00d07;"></i></li>':'<li class="task-self" taskid="'+i.task[r].id+'">'+i.task[r].name+'<i class="fa fa-trash-o del" style="color: #b00d07;"></i></li>'}t+="</ul>"}return t},y=function(){e.removeClass(e.$("#all"),"selected"),e.removeClass(e.$("#done"),"selected"),e.removeClass(e.$("#undone"),"selected")},m=function(o,i){y(),e.addClass(o,"selected");var r=e.$("#task-list");r.innerHTML=v(-1==n?t.queryAllTasks(i):"cate"===a?t.queryTasksByCateId(n,i):t.queryTasksByChildCateId(n,i))},k=function(){e.addClickEvent(e.$("#all"),function(){m(this)}),e.addClickEvent(e.$("#undone"),function(){m(this,!1)}),e.addClickEvent(e.$("#done"),function(){m(this,!0)})},C=function(t){S(),e.addClass(t,"selected");var n=t.getAttribute("taskid");o=n,T(n),B()},T=function(n){console.log("in showTaskContentById");var a=t.queryTaskById(n);if(console.log(a.done),a.done)e.$(".operation").innerHTML="";else{var o='<i class="fa fa-pencil-square-o" id="edit-icon" style="font-size: 25px; margin-right: 15px; cursor: pointer;" aria-hidden="true"></i>';o+='<i class="fa fa-check-square-o" id="check-icon" style="font-size: 25px; cursor: pointer;" aria-hidden="true"></i>',e.$(".operation").innerHTML=o,e.addClickEvent(e.$("#check-icon"),L),e.addClickEvent(e.$("#edit-icon"),x)}e.$(".todo-name").innerHTML=a.name,e.$(".date span").innerHTML=a.date,e.$(".content").innerHTML=a.content,e.$(".button-area").style.display="none"},S=function(){for(var t=e.$("#task-list").getElementsByTagName("li"),n=0,a=t.length;n<a;n++)e.removeClass(t[n],"selected")},E=function(){console.log("in clickAddTask"),console.log(typeof n),-1==n||"childCate"!==a?(alert("请选择具体子分类，若没有，请先建立子分类"),O()):0==n?(alert("不能给默认子分类添加任务"),O()):(b(),B())},b=function(){e.$(".todo-name").innerHTML='<input type="text" class="input-title" maxlength="15" placeholder="请输入标题（不超过15字符）...">',e.$(".date span").innerHTML='<input type="date" class="input-date">',e.$(".content").innerHTML='<textarea class="text-content" placeholder="请输入内容..."></textarea>',e.$(".button-area").style.display="block"},w=function(){console.log("in updateTaskList");var o=e.$("#task-list");"allCate"===a?(console.log("allCate"),o.innerHTML=v(t.queryAllTasks())):"cate"===a?(console.log("cate"),o.innerHTML=v(t.queryTasksByCateId(n))):(console.log("childCate"),console.log(n),o.innerHTML=v(t.queryTasksByChildCateId(n)))},N=function(){var a,i,s=e.$(".input-title").value,c=e.$(".input-date").value,d=e.$(".text-content").value;e.$("#task-list");if(!(s&&c&&d))return alert("标题、日期和任务内容都不能为空，请重新输入。"),void b();if(r)a=o,console.log("before:"+localStorage.task),t.updateTaskById(o,s,c,d),console.log("after:"+localStorage.task);else{var u={};u.name=e.escape(s),u.date=e.escape(c),u.content=e.escape(d),u.done=!1,u.parent=n,console.log(u),i=t.addTask(u),console.log("after addTask, currentTaskId:  "+i)}w(),console.log("currentTaskId again: "+o),T(o=r?a:i),l(),r=!1},$=function(){T(o)},L=function(){confirm("确定将任务标记为已完成吗？")&&(t.updateTaskStatusById(o),T(o),m(e.$("#all")))},x=function(){var n=t.queryTaskById(o);e.$(".todo-name").innerHTML='<input type="text" class="input-title" max-length="20" placeholder="请输入标题..." value="'+n.name+'">',e.$(".date span").innerHTML='<input type="date" class="input-date" value="'+n.date+'">',e.$(".content").innerHTML='<textarea class="text-content" placeholder="请输入内容...">'+n.content+"</textarea>",e.$(".button-area").style.display="block",r=!0},O=function(){console.log("in setCurr1"),e.$(".category").setAttribute("class","category view curr"),e.$(".list-all").setAttribute("class","list-all view next"),i=1,M(1)},A=function(){console.log("in setCurr2"),e.$(".category").setAttribute("class","category view last"),e.$(".list-all").setAttribute("class","list-all view curr"),e.$(".description").setAttribute("class","description view next"),i=2,M(2)},B=function(){console.log("in setCurr3"),e.$(".list-all").setAttribute("class","list-all view last"),e.$(".description").setAttribute("class","description view curr"),i=3,M(3)},M=function(t){if(window.innerWidth<760){var n=e.$("#backto");switch(t){case 1:n.style.display="none";break;case 2:case 3:n.style.display="block"}}},q=function(){if(window.innerWidth<760){console.log("in clickBackTo"),console.log("currentPage: "+i);e.$("#backto");switch(i){case 2:O();break;case 3:A()}}},I=function(){return"ontouchstart"in window||navigator.maxTouchPoints},H=function(){if(console.log("touch-device?  "+I()),I()){var e=document.styleSheets[0],t=e.cssRules.length;e.insertRule("#all-tasks:hover {border: none; border-radius: 0; box-shadow: none; transition: none;}",t),e.insertRule(".folder:hover {border: none; border-radius: 0; box-shadow: none; transition: none;}",t+1),e.insertRule(".file:hover {border: none; border-radius: 0; box-shadow: none; transition: none;}",t+2),e.insertRule(".task-self:hover {border: none; border-radius: 0; box-shadow: none; transition: none;}",t+3),e.insertRule(".add:hover {box-shadow: none; transition: none;}",t+4),e.insertRule(".filter:hover {color: #000;}",t+5),e.insertRule(".del {visibility: visible;}",t+6)}};return{initAll:function(){t.initDataBase(),l(),s(),e.$("#task-list").innerHTML=v(t.queryAllTasks()),k(),e.addClass(e.$("[taskid]"),"selected"),T(e.$("[taskid]").getAttribute("taskid")),H(),document.ontouchmove=function(e){e.preventDefault()},e.addClickEvent(e.$(".category .add"),c),e.addClickEvent(e.$(".list-all .add"),E),e.addClickEvent(e.$("#all-tasks"),function(){h(this)}),e.addClickEvent(e.$("#backto"),q),e.addClickEvent(e.$(".save"),N),e.addClickEvent(e.$(".cancel-save"),$),e.addClickEvent(e.$(".ok"),u),e.addClickEvent(e.$(".cancel-ok"),f),e.delegateEvent(e.$("#list-content"),"p","click",function(){h(this)}),e.delegateEvent(e.$("#task-list"),"li","click",function(){C(this)}),e.delegateDelEvent(e.$("#list-content"),"fa-trash-o","click",function(){d(event,this)}),e.delegateDelEvent(e.$("#task-list"),"fa-trash-o","click",function(){d(event,this)}),e.addEvent(window,"resize",function(){window.innerWidth>760?e.$("#backto").style.display="none":I()||(console.log("in window.onresize"),q(i))})}}}),function(){"use strict";function e(t,a){var o;if(a=a||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=a.touchBoundary||10,this.layer=t,this.tapDelay=a.tapDelay||200,this.tapTimeout=a.tapTimeout||700,!e.notNeeded(t)){for(var i=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],r=this,l=0,s=i.length;l<s;l++)r[i[l]]=function(e,t){return function(){return e.apply(t,arguments)}}(r[i[l]],r);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,a){var o=Node.prototype.removeEventListener;"click"===e?o.call(t,e,n.hijacked||n,a):o.call(t,e,n,a)},t.addEventListener=function(e,n,a){var o=Node.prototype.addEventListener;"click"===e?o.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),a):o.call(t,e,n,a)}),"function"==typeof t.onclick&&(o=t.onclick,t.addEventListener("click",function(e){o(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,a=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,o=a&&/OS 4_\d(_\d)?/.test(navigator.userAgent),i=a&&/OS [6-7]_\d/.test(navigator.userAgent),r=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(a&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,a;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),a=t.changedTouches[0],(n=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(e),!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;a&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;if(!(t=e.fastClickScrollParent)||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,i;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0],a){if((i=window.getSelection()).rangeCount&&!i.isCollapsed)return!0;if(!o){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n},e.prototype.onTouchMove=function(e){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0)},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,r,l,s,c,d=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,r=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,i&&(c=e.changedTouches[0],(d=document.elementFromPoint(c.pageX-window.pageXOffset,c.pageY-window.pageYOffset)||d).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(l=d.tagName.toLowerCase())){if(t=this.findControl(d)){if(this.focus(d),n)return!1;d=t}}else if(this.needsFocus(d))return e.timeStamp-r>100||a&&window.top!==window&&"input"===l?(this.targetElement=null,!1):(this.focus(d),this.sendClick(d,e),a&&"select"===l||(this.targetElement=null,e.preventDefault()),!1);return!(!a||o||!(s=d.fastClickScrollParent)||s.fastClickLastScrollTop===s.scrollTop)||(this.needsClick(d)||(e.preventDefault(),this.sendClick(d,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return!this.targetElement||(!!e.forwardedTouchEvent||(!e.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1))))},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail||((t=this.onMouse(e))||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,a,o;if(void 0===window.ontouchstart)return!0;if(a=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(a>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(r&&(o=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]>=10&&o[2]>=3&&(t=document.querySelector("meta[name=viewport]"))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction||(!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(t=document.querySelector("meta[name=viewport]"))&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||"none"===e.style.touchAction||"manipulation"===e.style.touchAction)},e.attach=function(t,n){return new e(t,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("fastclick",[],function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),console.log("in main.js"),require.config({paths:{util:"./helper/util",fastclick:"./helper/fastclick"}}),require(["control","fastclick"],function(e,t){e.initAll(),console.log(t),t.attach(document.body)}),define("main",["control","fastclick"],function(){});